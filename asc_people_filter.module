<?php
/**
* * Implementation of hook_form_alter()
* */
function asc_people_filter_form_alter(&$form, $form_state, $form_id) {
    
    if ($form['#id'] == 'views-exposed-form-People-page-1') {
      $form['appt']['#options']['All'] = t('All');
      $form['area']['#options']['All'] = t('All');
    }

}


function _people_form_build() {
  $view = views_get_view('jewelry');
  $display_id = 'page';
  $view->set_display($display_id);
  $view->init_handlers(); //initialize display handlers
  $form_state = array(
    'view' => $view,
    'display' => $view->display_handler->display,
    'exposed_form_plugin' => $view->display_handler->get_plugin('exposed_form'), //exposed form plugins are used in Views 3
    'method' => 'get',
    'rerender' => TRUE,
    'no_redirect' => TRUE,
  );
  $form = drupal_build_form('views_exposed_form', $form_state); //create the filter form

  dsm($form);
  $he = drupal_render($form);
  return $he;
  )
}


function asc_people_filter_block($op = 'list', $delta = 0, $edit = array()) {
  switch ($op) {
    case 'list':
      $blocks[0]['info'] = t('Active Filters');
      $blocks[0]['cache'] = BLOCK_NO_CACHE;
      $blocks[1]['info'] = t('Appointments');
      $blocks[2]['info'] = t('Research Interests');
      return $blocks;

    case 'view':
      if ($delta == 0) {
        $terms = array();

        if (isset($_GET['area']) && $_GET['area'] != "All") {
          $term = taxonomy_get_term($_GET['area']);
          $terms[] = $term->name;
        }

        if (isset($_GET['appt']) && $_GET['appt'] != "All") {
          $term = taxonomy_get_term($_GET['appt']);
          $terms[] = $term->name;
        }

        $block['subject'] = t('Active Filters');
        $block['content'] = theme('item_list',$terms);
      }      
      elseif ($delta == 1) {
        $block['content'] = _people_form_build();
        $block['subject'] = "";
      }
      elseif ($delta == 2) {
        $block['content'] = drupal_get_form('views-exposed-form-People-page-1');
        $block['subject'] = "";
      }
      return $block;
  }  
}

?>
